{"version":3,"sources":["../src/learningmap.js"],"names":["init","selectedElement","offset","firstPlace","secondPlace","lastTarget","elementForActivitySelector","mapdiv","document","getElementById","code","activitySetting","activitySelector","activityStarting","activityTarget","addEventListener","setActivityIdInPlacestore","value","checked","placestore","startingplaces","push","filter","e","updateCode","targetplaces","JSON","parse","getElementsByName","refreshBackgroundImage","id","places","paths","placecolor","strokecolor","height","width","innerHTML","dblclickHandler","clickHandler","showContextMenu","preventDefault","classList","remove","target","contains","add","activityId","getActivityIdFromPlacestore","setAttribute","offsetY","offsetX","removeAttribute","includes","hideContextMenu","backgroundfileNode","observer","MutationObserver","observe","attributes","childList","subtree","el","startDrag","drag","endDrag","getMousePosition","evt","CTM","getScreenCTM","touches","x","clientX","a","y","clientY","f","d","parseFloat","getAttributeNS","coord","cx","cy","setAttributeNS","upd1","p","fid","forEach","upd2","sid","background","parseInt","getBBox","processPlacestore","stringify","event","addPlace","removePlace","removePath","title","createElementNS","circle","r","classes","line","x1","y1","x2","y2","link","child","appendChild","placesgroup","placeId","linkId","linkedActivity","length","replace","z","addPath","first","pid","pathsgroup","second","baseVal","place","parent","parentNode","removePathsTouchingPlace","removeChild","path","removePathFromPlacestore","previewimage","getElementsByClassName","getAttribute","split","svg"],"mappings":"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","sourcesContent":["/* eslint-disable require-jsdoc */\nexport const init = () => {\n    var selectedElement, offset;\n\n    var firstPlace = null,\n        secondPlace = null,\n        lastTarget = null;\n\n    var elementForActivitySelector = null;\n\n    let mapdiv = document.getElementById('learningmap-editor-map');\n    let code = document.getElementById('id_introeditor_text');\n    let activitySetting = document.getElementById('learningmap-activity-setting');\n    let activitySelector = document.getElementById('learningmap-activity-selector');\n    let activityStarting = document.getElementById('learningmap-activity-starting');\n    let activityTarget = document.getElementById('learningmap-activity-target');\n    if (activitySelector) {\n        activitySelector.addEventListener('change', function() {\n            setActivityIdInPlacestore(elementForActivitySelector, activitySelector.value);\n        });\n        activityStarting.addEventListener('change', function() {\n            if (activityStarting.checked) {\n                placestore.startingplaces.push(elementForActivitySelector);\n            } else {\n                placestore.startingplaces = placestore.startingplaces.filter(function(e) {\n                    return e != elementForActivitySelector;\n                });\n            }\n            updateCode();\n        });\n        activityTarget.addEventListener('change', function() {\n            if (activityTarget.checked) {\n                placestore.targetplaces.push(elementForActivitySelector);\n            } else {\n                placestore.targetplaces = placestore.targetplaces.filter(function(e) {\n                    return e != elementForActivitySelector;\n                });\n            }\n            updateCode();\n        });\n    }\n\n    var placestore;\n    try {\n        placestore = JSON.parse(document.getElementsByName('placestore')[0].value);\n        refreshBackgroundImage();\n    } catch {\n        placestore = {\n            id: 0,\n            places: [],\n            paths: [],\n            startingplaces: [],\n            targetplaces: [],\n            placecolor: 'red',\n            strokecolor: 'white',\n            height: 100,\n            width: 800\n        };\n    }\n\n    mapdiv.innerHTML = code.value;\n\n    refreshBackgroundImage();\n\n    mapdiv.addEventListener('dblclick', dblclickHandler);\n    mapdiv.addEventListener('click', clickHandler);\n\n    mapdiv.addEventListener('contextmenu', function(e) {\n        showContextMenu(e);\n        e.preventDefault();\n    }, false);\n\n    function showContextMenu(e) {\n        if (elementForActivitySelector) {\n            document.getElementById(elementForActivitySelector).classList.remove('learningmap-selected-activity-selector');\n        }\n        if (activitySetting) {\n            if (e.target.classList.contains('learningmap-place')) {\n                e.target.classList.add('learningmap-selected-activity-selector');\n                let activityId = getActivityIdFromPlacestore(e.target.id);\n                activitySetting.setAttribute('style', 'top: ' + e.offsetY + 'px; left: ' + e.offsetX + 'px;');\n                activitySetting.removeAttribute('hidden');\n                document.getElementById('learningmap-activity-selector').value = activityId;\n                if (placestore.startingplaces.includes(e.target.id)) {\n                    document.getElementById('learningmap-activity-starting').setAttribute('checked', 'on');\n                } else {\n                    document.getElementById('learningmap-activity-starting').removeAttribute('checked', '');\n                }\n                if (placestore.targetplaces.includes(e.target.id)) {\n                    document.getElementById('learningmap-activity-target').setAttribute('checked', 'on');\n                } else {\n                    document.getElementById('learningmap-activity-target').removeAttribute('checked', '');\n                }\n                elementForActivitySelector = e.target.id;\n            } else {\n                hideContextMenu();\n            }\n        }\n    }\n\n    function hideContextMenu() {\n        let e = document.getElementById(elementForActivitySelector);\n        if (e) {\n            e.classList.remove('learningmap-selected-activity-selector');\n        }\n        activitySetting.setAttribute('hidden', '');\n    }\n\n    let backgroundfileNode = document.getElementById('id_introeditor_itemid_fieldset');\n    let observer = new MutationObserver(refreshBackgroundImage);\n\n    observer.observe(backgroundfileNode, {attributes: true, childList: true, subtree: true});\n\n    makeDraggable(document.getElementById('learningmap_svgmap'));\n\n    let background = document.getElementById('learningmap-background-image');\n\n    background.addEventListener('load', function() {\n        let height = parseInt(background.getBBox().height);\n        let width = background.getBBox().width;\n        placestore.height = height;\n        placestore.width = width;\n        updateCode();\n        processPlacestore();\n    });\n\n    function makeDraggable(el) {\n        el.addEventListener('mousedown', startDrag);\n        el.addEventListener('mousemove', drag);\n        el.addEventListener('mouseup', endDrag);\n        el.addEventListener('mouseleave', endDrag);\n        el.addEventListener('touchstart', startDrag);\n        el.addEventListener('touchmove', drag);\n        el.addEventListener('touchend', endDrag);\n        el.addEventListener('touchleave', endDrag);\n        el.addEventListener('touchcancel', endDrag);\n\n        function getMousePosition(evt) {\n            var CTM = el.getScreenCTM();\n            if (evt.touches) {\n                evt = evt.touches[0];\n            }\n            return {\n                x: (evt.clientX - CTM.e) / CTM.a,\n                y: (evt.clientY - CTM.f) / CTM.d\n            };\n        }\n\n        function startDrag(evt) {\n            if (evt.target.classList.contains('learningmap-draggable')) {\n                selectedElement = evt.target;\n                offset = getMousePosition(evt);\n                offset.x -= parseFloat(selectedElement.getAttributeNS(null, \"cx\"));\n                offset.y -= parseFloat(selectedElement.getAttributeNS(null, \"cy\"));\n            }\n        }\n\n        function drag(evt) {\n            if (selectedElement) {\n                evt.preventDefault();\n                var coord = getMousePosition(evt);\n                let cx = coord.x - offset.x;\n                let cy = coord.y - offset.y;\n                selectedElement.setAttributeNS(null, \"cx\", cx);\n                selectedElement.setAttributeNS(null, \"cy\", cy);\n                let upd1 = placestore.paths.filter(function(p) {\n                    return p.fid == selectedElement.id;\n                });\n                upd1.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x1', cx);\n                        d.setAttribute('y1', cy);\n                    }\n                });\n                let upd2 = placestore.paths.filter(function(p) {\n                    return p.sid == selectedElement.id;\n                });\n                upd2.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x2', cx);\n                        d.setAttribute('y2', cy);\n                    }\n                });\n            }\n        }\n\n        function endDrag() {\n            selectedElement = false;\n            updateCode();\n        }\n    }\n\n    function updateCode() {\n        let mapdiv = document.getElementById('learningmap-editor-map');\n        let code = document.getElementById('id_introeditor_text');\n        code.innerHTML = mapdiv.innerHTML;\n        document.getElementsByName('placestore')[0].value = JSON.stringify(placestore);\n    }\n\n    function dblclickHandler(event) {\n        hideContextMenu();\n        if (event.target.classList.contains('learningmap-mapcontainer') ||\n            event.target.classList.contains('learningmap-background-image')) {\n            addPlace(event);\n        } else if (event.target.classList.contains('learningmap-place')) {\n            if (lastTarget == event.target.id) {\n                lastTarget = null;\n                clickHandler(event);\n            } else {\n                removePlace(event);\n            }\n        } else if (event.target.classList.contains('learningmap-path')) {\n            removePath(event.target.id);\n        }\n        updateCode();\n    }\n\n    function title(id) {\n        let title = document.createElementNS('http://www.w3.org/2000/svg', 'title');\n        title.setAttribute('id', id);\n        return title;\n    }\n\n    function circle(x, y, r, classes, id) {\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        circle.setAttribute('class', classes);\n        circle.setAttribute('id', id);\n        circle.setAttribute('cx', x);\n        circle.setAttribute('cy', y);\n        circle.setAttribute('r', r);\n        return circle;\n    }\n\n    function line(x1, y1, x2, y2, classes, id) {\n        let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n        line.setAttribute('class', classes);\n        line.setAttribute('id', id);\n        line.setAttribute('x1', x1);\n        line.setAttribute('y1', y1);\n        line.setAttribute('x2', x2);\n        line.setAttribute('y2', y2);\n        return line;\n    }\n\n    function link(child, id, title = null) {\n        let link = document.createElementNS('http://www.w3.org/2000/svg', 'a');\n        link.setAttribute('id', id);\n        link.setAttribute('xlink:href', '');\n        link.appendChild(child);\n        if (!(title === null)) {\n            link.appendChild(title);\n        }\n        return link;\n    }\n\n    function addPlace(event) {\n        let placesgroup = document.getElementById('placesGroup');\n        let placeId = 'p' + placestore.id;\n        let linkId = 'a' + placestore.id;\n        var CTM = event.target.getScreenCTM();\n        if (event.touches) {\n            event = event.touches[0];\n        }\n        let cx = (event.clientX - CTM.e) / CTM.a;\n        let cy = (event.clientY - CTM.f) / CTM.d;\n        placesgroup.appendChild(\n            link(\n                circle(cx, cy, 10, 'learningmap-place learningmap-draggable', placeId),\n                linkId,\n                title('title' + placeId)\n            )\n        );\n        placestore.places.push({\n            id: placeId,\n            linkId: linkId,\n            linkedActivity: null\n        });\n        if (placestore.places.length == 1) {\n            placestore.startingplaces.push(placeId);\n        }\n        placestore.id++;\n    }\n\n    function clickHandler(event) {\n        hideContextMenu();\n        if (event.target.classList.contains('learningmap-place')) {\n            event.preventDefault();\n            if (firstPlace === null) {\n                firstPlace = event.target.id;\n                document.getElementById(firstPlace).classList.add('learningmap-selected');\n            } else {\n                secondPlace = event.target.id;\n                let fid = parseInt(firstPlace.replace('p', ''));\n                let sid = parseInt(secondPlace.replace('p', ''));\n                if (sid == fid) {\n                    return;\n                }\n                if (sid < fid) {\n                    let z = sid;\n                    sid = fid;\n                    fid = z;\n                }\n                addPath(fid, sid);\n                let first = document.getElementById(firstPlace);\n                if (first) {\n                    first.classList.remove('learningmap-selected');\n                }\n                firstPlace = null;\n                lastTarget = secondPlace;\n                secondPlace = null;\n            }\n        } else {\n            let p = document.getElementById(firstPlace);\n            if (!(p === null)) {\n                p.classList.remove('learningmap-selected');\n            }\n            firstPlace = null;\n        }\n    }\n\n    function addPath(fid, sid) {\n        let pid = 'p' + fid + '_' + sid;\n        if (document.getElementById(pid) === null) {\n            let pathsgroup = document.getElementById('pathsGroup');\n            let first = document.getElementById('p' + fid);\n            let second = document.getElementById('p' + sid);\n            if (pathsgroup && first && second) {\n                pathsgroup.appendChild(\n                    line(\n                        first.cx.baseVal.value,\n                        first.cy.baseVal.value,\n                        second.cx.baseVal.value,\n                        second.cy.baseVal.value,\n                        'learningmap-path',\n                        pid\n                    )\n                );\n                placestore.paths.push({\n                    id: pid,\n                    fid: 'p' + fid,\n                    sid: 'p' + sid\n                });\n            }\n        }\n    }\n\n    function removePlace(event) {\n        let place = document.getElementById(event.target.id);\n        let parent = place.parentNode;\n        removePathsTouchingPlace(event.target.id);\n        placestore.places = placestore.places.filter(\n            function(p) {\n                return p.id != event.target.id;\n            }\n        );\n        placestore.startingplaces = placestore.startingplaces.filter(\n            function(e) {\n                return e != event.target.id;\n            }\n        );\n        placestore.targetplaces = placestore.targetplaces.filter(\n            function(e) {\n                return e != event.target.id;\n            }\n        );\n        parent.removeChild(place);\n        parent.parentNode.removeChild(parent);\n\n        updateCode();\n    }\n\n    function removePathsTouchingPlace(id) {\n        placestore.paths.forEach(\n            function(e) {\n                if (e.fid == id || e.sid == id) {\n                    removePath(e.id);\n                }\n            }\n        );\n    }\n\n    function removePath(id) {\n        let path = document.getElementById(id);\n        if (!(path === null)) {\n            path.parentNode.removeChild(path);\n            removePathFromPlacestore(id);\n        }\n    }\n\n    function removePathFromPlacestore(pid) {\n        placestore.paths = placestore.paths.filter(\n            function(e) {\n                return pid != e.id;\n            }\n        );\n    }\n\n    function getActivityIdFromPlacestore(id) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            return place[0].linkedActivity;\n        } else {\n            return null;\n        }\n    }\n\n    function setActivityIdInPlacestore(id, linkedActivity) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            place[0].linkedActivity = linkedActivity;\n        }\n        updateCode();\n    }\n\n    function refreshBackgroundImage() {\n        let previewimage = document.getElementsByClassName('realpreview');\n        if (previewimage.length > 0) {\n            let background = document.getElementById('learningmap-background-image');\n            background.setAttribute('xlink:href', previewimage[0].getAttribute('src').split('?')[0]);\n        }\n    }\n\n    function processPlacestore() {\n        let svg = document.getElementById('learningmap_svgmap');\n        svg.setAttribute('viewBox', '0 0 ' + placestore.width + ' ' + placestore.height);\n    }\n\n};\n"],"file":"learningmap.min.js"}