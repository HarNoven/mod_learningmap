{"version":3,"sources":["../src/learningmap.js"],"names":["init","selectedElement","offset","firstPlace","secondPlace","lastTarget","elementForActivitySelector","mapdiv","document","getElementById","code","activitySetting","activitySelector","activityStarting","addEventListener","setActivityIdInPlacestore","value","checked","placestore","startingplaces","push","filter","e","updateCode","JSON","parse","getElementsByName","id","places","paths","placecolor","strokecolor","innerHTML","dblclickHandler","clickHandler","showContextMenu","preventDefault","classList","remove","target","contains","add","activityId","getActivityIdFromPlacestore","setAttribute","offsetY","offsetX","removeAttribute","includes","hideContextMenu","backgroundfileNode","observer","MutationObserver","previewimage","getElementsByClassName","length","background","getAttribute","split","observe","attributes","childList","subtree","el","startDrag","drag","endDrag","getMousePosition","evt","CTM","getScreenCTM","touches","x","clientX","a","y","clientY","f","d","parseFloat","getAttributeNS","coord","cx","cy","setAttributeNS","upd1","p","fid","forEach","upd2","sid","stringify","event","addPlace","removePlace","removePath","circle","r","classes","createElementNS","line","x1","y1","x2","y2","link","child","appendChild","placesgroup","placeId","linkId","linkedActivity","parseInt","replace","z","addPath","pid","pathsgroup","baseVal","place","parent","parentNode","path","removeChild","removePathFromPlacestore","pathentry"],"mappings":"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","sourcesContent":["/* eslint-disable require-jsdoc */\nexport const init = () => {\n    var selectedElement, offset;\n\n    var firstPlace = null,\n        secondPlace = null,\n        lastTarget = null;\n\n    var elementForActivitySelector = null;\n\n    let mapdiv = document.getElementById('learningmap-editor-map');\n    let code = document.getElementById('id_introeditor_text');\n    let activitySetting = document.getElementById('learningmap-activity-setting');\n    let activitySelector = document.getElementById('learningmap-activity-selector');\n    let activityStarting = document.getElementById('learningmap-activity-starting');\n    if (activitySelector) {\n        activitySelector.addEventListener('change', function() {\n            setActivityIdInPlacestore(elementForActivitySelector, activitySelector.value);\n        });\n        activityStarting.addEventListener('change', function() {\n            if (activityStarting.checked) {\n                placestore.startingplaces.push(elementForActivitySelector);\n            } else {\n                placestore.startingplaces = placestore.startingplaces.filter(function(e) {\n                    return e != elementForActivitySelector;\n                });\n            }\n            updateCode();\n        });\n    }\n\n    var placestore;\n    try {\n        placestore = JSON.parse(document.getElementsByName('placestore')[0].value);\n    } catch {\n        placestore = {\n            id: 0,\n            places: [],\n            paths: [],\n            startingplaces: ['p0'], //for testing\n            placecolor: 'red',\n            strokecolor: 'white'\n        };\n    }\n\n    mapdiv.innerHTML = code.value;\n\n    mapdiv.addEventListener('dblclick', dblclickHandler);\n    mapdiv.addEventListener('click', clickHandler);\n\n    mapdiv.addEventListener('contextmenu', function(e) {\n        showContextMenu(e);\n        e.preventDefault();\n    }, false);\n\n    function showContextMenu(e) {\n        if (elementForActivitySelector) {\n            document.getElementById(elementForActivitySelector).classList.remove('selected2');\n        }\n        if (activitySetting) {\n            if (e.target.classList.contains('place')) {\n                e.target.classList.add('selected2');\n                let activityId = getActivityIdFromPlacestore(e.target.id);\n                activitySetting.setAttribute('style', 'top: ' + e.offsetY + 'px; left: ' + e.offsetX + 'px;');\n                activitySetting.removeAttribute('hidden');\n                document.getElementById('learningmap-activity-selector').value = activityId;\n                if (placestore.startingplaces.includes(e.target.id)) {\n                    document.getElementById('learningmap-activity-starting').setAttribute('checked', '');\n                } else {\n                    document.getElementById('learningmap-activity-starting').removeAttribute('checked', '');\n                }\n                elementForActivitySelector = e.target.id;\n            } else {\n                hideContextMenu();\n            }\n        }\n    }\n\n    function hideContextMenu() {\n        let e = document.getElementById(elementForActivitySelector);\n        if (e) {\n            e.classList.remove('selected2');\n        }\n        activitySetting.setAttribute('hidden', '');\n    }\n\n    let backgroundfileNode = document.getElementById('id_introeditor_itemid_fieldset');\n    let observer = new MutationObserver(refreshBackgroundImage);\n\n    observer.observe(backgroundfileNode, { attributes: true, childList: true, subtree: true });\n\n    makeDraggable(document.getElementById('learningmap_svgmap'));\n\n    function makeDraggable(el) {\n        el.addEventListener('mousedown', startDrag);\n        el.addEventListener('mousemove', drag);\n        el.addEventListener('mouseup', endDrag);\n        el.addEventListener('mouseleave', endDrag);\n        el.addEventListener('touchstart', startDrag);\n        el.addEventListener('touchmove', drag);\n        el.addEventListener('touchend', endDrag);\n        el.addEventListener('touchleave', endDrag);\n        el.addEventListener('touchcancel', endDrag);\n\n        function getMousePosition(evt) {\n            var CTM = el.getScreenCTM();\n            if (evt.touches) {\n                evt = evt.touches[0];\n            }\n            return {\n                x: (evt.clientX - CTM.e) / CTM.a,\n                y: (evt.clientY - CTM.f) / CTM.d\n            };\n        }\n\n        function startDrag(evt) {\n            if (evt.target.classList.contains('draggable')) {\n                selectedElement = evt.target;\n                offset = getMousePosition(evt);\n                offset.x -= parseFloat(selectedElement.getAttributeNS(null, \"cx\"));\n                offset.y -= parseFloat(selectedElement.getAttributeNS(null, \"cy\"));\n            }\n        }\n\n        function drag(evt) {\n            if (selectedElement) {\n                evt.preventDefault();\n                var coord = getMousePosition(evt);\n                let cx = coord.x - offset.x;\n                let cy = coord.y - offset.y;\n                selectedElement.setAttributeNS(null, \"cx\", cx);\n                selectedElement.setAttributeNS(null, \"cy\", cy);\n                let upd1 = placestore.paths.filter(function(p) {\n                    return p.fid == selectedElement.id;\n                });\n                upd1.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x1', cx);\n                        d.setAttribute('y1', cy);\n                    }\n                });\n                let upd2 = placestore.paths.filter(function(p) {\n                    return p.sid == selectedElement.id;\n                });\n                upd2.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x2', cx);\n                        d.setAttribute('y2', cy);\n                    }\n                });\n            }\n        }\n\n        function endDrag() {\n            selectedElement = false;\n            updateCode();\n        }\n    }\n\n    function updateCode() {\n        let mapdiv = document.getElementById('learningmap-editor-map');\n        let code = document.getElementById('id_introeditor_text');\n        code.value = mapdiv.innerHTML;\n        document.getElementsByName('placestore')[0].value = JSON.stringify(placestore);\n    }\n\n    function dblclickHandler(event) {\n        hideContextMenu();\n        if (event.target.classList.contains('learningmap-mapcontainer') ||\n            event.target.classList.contains('learningmap-background-image')) {\n            addPlace(event);\n        } else if (event.target.classList.contains('place')) {\n            if (lastTarget == event.target.id) {\n                lastTarget = null;\n                clickHandler(event);\n            } else {\n                removePlace(event);\n            }\n        } else if (event.target.classList.contains('path')) {\n            removePath(event.target.id);\n        }\n        updateCode();\n    }\n\n    function circle(x, y, r, classes, id) {\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        circle.setAttribute('class', classes);\n        circle.setAttribute('id', id);\n        circle.setAttribute('cx', x);\n        circle.setAttribute('cy', y);\n        circle.setAttribute('r', r);\n        return circle;\n    }\n\n    function line(x1, y1, x2, y2, classes, id) {\n        let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n        line.setAttribute('class', classes);\n        line.setAttribute('id', id);\n        line.setAttribute('x1', x1);\n        line.setAttribute('y1', y1);\n        line.setAttribute('x2', x2);\n        line.setAttribute('y2', y2);\n        return line;\n    }\n\n    function link(child, id) {\n        let link = document.createElementNS('http://www.w3.org/2000/svg', 'a');\n        link.setAttribute('id', id);\n        link.setAttribute('xlink:href', '');\n        link.appendChild(child);\n        return link;\n    }\n\n    function addPlace(event) {\n        let placesgroup = document.getElementById('placesGroup');\n        let placeId = 'p' + placestore.id;\n        let linkId = 'a' + placestore.id;\n        placesgroup.appendChild(\n            link(\n                circle(event.offsetX, event.offsetY, 10, 'place draggable', placeId),\n                linkId\n            )\n        );\n        placestore.places[placestore.id] = {\n            id: placeId,\n            linkId: linkId,\n            linkedActivity: null,\n            paths: []\n        };\n        placestore.id++;\n    }\n\n    function clickHandler(event) {\n        hideContextMenu();\n        if (event.target.classList.contains('place')) {\n            event.preventDefault();\n            if (firstPlace === null) {\n                firstPlace = event.target.id;\n                document.getElementById(firstPlace).classList.add('selected');\n            } else {\n                secondPlace = event.target.id;\n                let fid = parseInt(firstPlace.replace('p', ''));\n                let sid = parseInt(secondPlace.replace('p', ''));\n                if (sid == fid) {\n                    return;\n                }\n                if (sid < fid) {\n                    let z = sid;\n                    sid = fid;\n                    fid = z;\n                }\n                addPath(fid, sid);\n                document.getElementById(firstPlace).classList.remove('selected');\n                firstPlace = null;\n                lastTarget = secondPlace;\n                secondPlace = null;\n            }\n        } else {\n            let p = document.getElementById(firstPlace);\n            if (!(p === null)) {\n                p.classList.remove('selected');\n            }\n            firstPlace = null;\n        }\n    }\n\n    function addPath(fid, sid) {\n        let pid = 'p' + fid + '_' + sid;\n        if (document.getElementById(pid) === null) {\n            let pathsgroup = document.getElementById('pathsGroup');\n            pathsgroup.appendChild(\n                line(\n                    document.getElementById('p' + fid).cx.baseVal.value,\n                    document.getElementById('p' + fid).cy.baseVal.value,\n                    document.getElementById('p' + sid).cx.baseVal.value,\n                    document.getElementById('p' + sid).cy.baseVal.value,\n                    'path',\n                    pid\n                )\n            );\n            placestore.places[fid].paths.push(pid);\n            placestore.places[sid].paths.push(pid);\n            placestore.paths.push({\n                id: pid,\n                fid: 'p' + fid,\n                sid: 'p' + sid\n            });\n        }\n    }\n\n    function removePlace(event) {\n        let place = document.getElementById(event.target.id);\n        let parent = place.parentNode;\n        let placeId = parseInt(place.id.replace('p', ''));\n        let paths = placestore.places[placeId].paths;\n        (paths).forEach(path => {\n            removePath(path);\n        });\n        placestore.places = placestore.places.filter(\n            function(p) {\n                return p.id != placeId;\n            }\n        );\n        placestore.startingplaces.remove(event.target.id);\n        parent.removeChild(place);\n        parent.parentNode.removeChild(parent);\n\n        updateCode();\n    }\n\n    function removePath(id) {\n        let path = document.getElementById(id);\n        if (!(path === null)) {\n            path.parentNode.removeChild(path);\n            removePathFromPlacestore(id);\n        }\n    }\n\n    function removePathFromPlacestore(pid) {\n        let pathentry = placestore.paths.filter(\n            function(e) {\n                return pid == e.id;\n            }\n        )[0];\n        placestore.places[pathentry.fid].paths = placestore.places[pathentry.fid].paths.filter(\n            function(p) {\n                return pid != p;\n            }\n        );\n        placestore.places[pathentry.sid].paths = placestore.places[pathentry.sid].paths.filter(\n            function(p) {\n                return pid != p;\n            }\n        );\n        placestore.paths = placestore.paths.filter(\n            function(e) {\n                return pid != e.id;\n            }\n        );\n    }\n\n    function getActivityIdFromPlacestore(id) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            return place[0].linkedActivity;\n        } else {\n            return null;\n        }\n    }\n\n    function setActivityIdInPlacestore(id, linkedActivity) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            place[0].linkedActivity = linkedActivity;\n        }\n        updateCode();\n    }\n\n    function refreshBackgroundImage() {\n        let previewimage = document.getElementsByClassName('realpreview');\n        if (previewimage.length > 0) {\n            let background = document.getElementById('learningmap-background-image');\n            background.setAttribute('xlink:href', previewimage[0].getAttribute('src').split('?')[0]);\n            updateCode();\n        }\n    }\n\n};\n"],"file":"learningmap.min.js"}