{"version":3,"sources":["../src/learningmap.js"],"names":["init","Templates","prefetchTemplates","selectedElement","offset","upd1","upd2","firstPlace","secondPlace","lastTarget","elementForActivitySelector","mapdiv","document","getElementById","code","activitySetting","activitySelector","activityStarting","activityTarget","colorChooserPlace","colorChooserVisited","colorChooserPath","addEventListener","setActivityIdInPlacestore","value","checked","placestore","startingplaces","push","filter","e","updateCode","targetplaces","id","places","paths","placecolor","strokecolor","visitedcolor","height","width","editmode","fromjson","JSON","parse","getElementsByName","Object","assign","refreshBackgroundImage","updateCSS","innerHTML","background","parseInt","getBBox","processPlacestore","el","startDrag","drag","endDrag","getMousePosition","evt","CTM","getScreenCTM","touches","x","clientX","a","y","clientY","f","d","preventDefault","target","classList","contains","getAttributeNS","p","fid","sid","coord","cx","cy","setAttributeNS","forEach","setAttribute","dblclickHandler","clickHandler","showContextMenu","remove","add","activityId","getActivityIdFromPlacestore","offsetY","offsetX","removeAttribute","includes","hideContextMenu","backgroundfileNode","observer","MutationObserver","observe","attributes","childList","subtree","stringify","event","addPlace","removePlace","removePath","title","createElementNS","circle","r","classes","line","x1","y1","x2","y2","link","child","appendChild","placesgroup","placeId","linkId","linkedActivity","length","replace","z","addPath","first","pid","pathsgroup","second","baseVal","place","parent","parentNode","removePathsTouchingPlace","removeChild","path","removePathFromPlacestore","previewimage","getElementsByClassName","getAttribute","split","svg","renderForPromise","then","html","js","replaceNode","catch","ex"],"mappings":"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","sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nexport const init = () => {\n    Templates.prefetchTemplates(['mod_learningmap/cssskeleton']);\n\n    var selectedElement, offset, upd1, upd2;\n\n    var firstPlace = null,\n        secondPlace = null,\n        lastTarget = null;\n\n    var elementForActivitySelector = null;\n\n    let mapdiv = document.getElementById('learningmap-editor-map');\n    let code = document.getElementById('id_introeditor_text');\n    let activitySetting = document.getElementById('learningmap-activity-setting');\n    let activitySelector = document.getElementById('learningmap-activity-selector');\n    let activityStarting = document.getElementById('learningmap-activity-starting');\n    let activityTarget = document.getElementById('learningmap-activity-target');\n    let colorChooserPlace = document.getElementById('learningmap-color-place');\n    let colorChooserVisited = document.getElementById('learningmap-color-visited');\n    let colorChooserPath = document.getElementById('learningmap-color-path');\n\n    if (activitySelector) {\n        activitySelector.addEventListener('change', function() {\n            setActivityIdInPlacestore(elementForActivitySelector, activitySelector.value);\n        });\n        activityStarting.addEventListener('change', function() {\n            if (activityStarting.checked) {\n                placestore.startingplaces.push(elementForActivitySelector);\n            } else {\n                placestore.startingplaces = placestore.startingplaces.filter(function(e) {\n                    return e != elementForActivitySelector;\n                });\n            }\n            updateCode();\n        });\n        activityTarget.addEventListener('change', function() {\n            if (activityTarget.checked) {\n                placestore.targetplaces.push(elementForActivitySelector);\n            } else {\n                placestore.targetplaces = placestore.targetplaces.filter(function(e) {\n                    return e != elementForActivitySelector;\n                });\n            }\n            updateCode();\n        });\n    }\n\n    var placestore = {\n        id: 0,\n        places: [],\n        paths: [],\n        startingplaces: [],\n        targetplaces: [],\n        placecolor: '#c01c28',\n        strokecolor: '#ffffff',\n        visitedcolor: '#26a269',\n        height: 100,\n        width: 800,\n        editmode: true // This will be removed by data_postprocessing.\n    };\n\n    try {\n        let fromjson = JSON.parse(document.getElementsByName('placestore')[0].value);\n        Object.assign(placestore, fromjson);\n        refreshBackgroundImage();\n    } catch {}\n\n    if (colorChooserPath) {\n        colorChooserPath.addEventListener('change', function() {\n            placestore.strokecolor = colorChooserPath.value;\n            updateCSS();\n        });\n        colorChooserPath.value = placestore.strokecolor;\n    }\n\n    if (colorChooserPlace) {\n        colorChooserPlace.addEventListener('change', function() {\n            placestore.placecolor = colorChooserPlace.value;\n            updateCSS();\n        });\n        colorChooserPlace.value = placestore.placecolor;\n    }\n\n    if (colorChooserVisited) {\n        colorChooserVisited.addEventListener('change', function() {\n            placestore.visitedcolor = colorChooserVisited.value;\n            updateCSS();\n        });\n        colorChooserVisited.value = placestore.visitedcolor;\n    }\n\n    mapdiv.innerHTML = code.value;\n\n    refreshBackgroundImage();\n    registerBackgroundListener();\n    makeDraggable(document.getElementById('learningmap-svgmap'));\n\n    updateCSS();\n\n    mapdiv.addEventListener('dblclick', dblclickHandler);\n    mapdiv.addEventListener('click', clickHandler);\n\n    mapdiv.addEventListener('contextmenu', function(e) {\n        showContextMenu(e);\n        e.preventDefault();\n    }, false);\n\n    /**\n     * Shows the context menu at the current mouse position\n     * @param {*} e\n     */\n    function showContextMenu(e) {\n        if (elementForActivitySelector) {\n            document.getElementById(elementForActivitySelector).classList.remove('learningmap-selected-activity-selector');\n        }\n        if (activitySetting) {\n            if (e.target.classList.contains('learningmap-place')) {\n                e.target.classList.add('learningmap-selected-activity-selector');\n                let activityId = getActivityIdFromPlacestore(e.target.id);\n                activitySetting.setAttribute('style', 'top: ' + e.offsetY + 'px; left: ' + e.offsetX + 'px;');\n                activitySetting.removeAttribute('hidden');\n                document.getElementById('learningmap-activity-selector').value = activityId;\n                if (placestore.startingplaces.includes(e.target.id)) {\n                    document.getElementById('learningmap-activity-starting').checked = true;\n                } else {\n                    document.getElementById('learningmap-activity-starting').checked = false;\n                }\n                if (placestore.targetplaces.includes(e.target.id)) {\n                    document.getElementById('learningmap-activity-target').checked = true;\n                } else {\n                    document.getElementById('learningmap-activity-target').checked = false;\n                }\n                elementForActivitySelector = e.target.id;\n            } else {\n                hideContextMenu();\n            }\n        }\n    }\n\n    /**\n     * Hides the context menu\n     */\n    function hideContextMenu() {\n        let e = document.getElementById(elementForActivitySelector);\n        if (e) {\n            e.classList.remove('learningmap-selected-activity-selector');\n        }\n        activitySetting.setAttribute('hidden', '');\n    }\n\n    let backgroundfileNode = document.getElementById('id_introeditor_itemid_fieldset');\n    let observer = new MutationObserver(refreshBackgroundImage);\n    observer.observe(backgroundfileNode, {attributes: true, childList: true, subtree: true});\n\n    /**\n     * Enables dragging on an DOM node\n     * @param {*} el\n     */\n    function makeDraggable(el) {\n        el.addEventListener('mousedown', startDrag);\n        el.addEventListener('mousemove', drag);\n        el.addEventListener('mouseup', endDrag);\n        el.addEventListener('mouseleave', endDrag);\n        el.addEventListener('touchstart', startDrag);\n        el.addEventListener('touchmove', drag);\n        el.addEventListener('touchend', endDrag);\n        el.addEventListener('touchleave', endDrag);\n        el.addEventListener('touchcancel', endDrag);\n\n        /**\n         * Helper function for getting the right coordinates from the mouse\n         * @param {*} evt\n         * @returns {object}\n         */\n        function getMousePosition(evt) {\n            var CTM = el.getScreenCTM();\n            if (evt.touches) {\n                evt = evt.touches[0];\n            }\n            return {\n                x: (evt.clientX - CTM.e) / CTM.a,\n                y: (evt.clientY - CTM.f) / CTM.d\n            };\n        }\n\n        /**\n         * Function called whenn dragging starts.\n         * @param {*} evt\n         */\n        function startDrag(evt) {\n            evt.preventDefault();\n            if (evt.target.classList.contains('learningmap-draggable')) {\n                selectedElement = evt.target;\n                offset = getMousePosition(evt);\n                offset.x -= parseInt(selectedElement.getAttributeNS(null, \"cx\"));\n                offset.y -= parseInt(selectedElement.getAttributeNS(null, \"cy\"));\n                // Get paths that need to be updated.\n                upd1 = placestore.paths.filter(function(p) {\n                    return p.fid == selectedElement.id;\n                });\n                upd2 = placestore.paths.filter(function(p) {\n                    return p.sid == selectedElement.id;\n                });\n            }\n        }\n\n        /**\n         * Function called during dragging. Continuously updates circles center coordinates and the\n         * coordinates of the touching paths.\n         * @param {*} evt\n         */\n        function drag(evt) {\n            evt.preventDefault();\n            if (selectedElement) {\n                var coord = getMousePosition(evt);\n                let cx = coord.x - offset.x;\n                let cy = coord.y - offset.y;\n                selectedElement.setAttributeNS(null, \"cx\", cx);\n                selectedElement.setAttributeNS(null, \"cy\", cy);\n\n                upd1.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x1', cx);\n                        d.setAttribute('y1', cy);\n                    }\n                });\n\n                upd2.forEach(function(p) {\n                    let d = document.getElementById(p.id);\n                    if (!(d === null)) {\n                        d.setAttribute('x2', cx);\n                        d.setAttribute('y2', cy);\n                    }\n                });\n            }\n        }\n\n        /**\n         * Function called when dragging ends.\n         * @param {*} evt\n         */\n        function endDrag(evt) {\n            evt.preventDefault();\n            selectedElement = false;\n            updateCode();\n        }\n    }\n\n    /**\n     * Updates the form fields for the SVG code and the placestore from the editor.\n     */\n    function updateCode() {\n        let mapdiv = document.getElementById('learningmap-editor-map');\n        let code = document.getElementById('id_introeditor_text');\n        code.innerHTML = mapdiv.innerHTML;\n        document.getElementsByName('placestore')[0].value = JSON.stringify(placestore);\n    }\n\n    /**\n     * Handles double clicks on the map\n     * @param {*} event\n     */\n    function dblclickHandler(event) {\n        hideContextMenu();\n        if (event.target.classList.contains('learningmap-mapcontainer') ||\n            event.target.classList.contains('learningmap-background-image')) {\n            addPlace(event);\n        } else if (event.target.classList.contains('learningmap-place')) {\n            if (lastTarget == event.target.id) {\n                lastTarget = null;\n                clickHandler(event);\n            } else {\n                removePlace(event);\n            }\n        } else if (event.target.classList.contains('learningmap-path')) {\n            removePath(event.target.id);\n        }\n        updateCode();\n    }\n\n    /**\n     * Returns an empty title tag with the given id.\n     * @param {*} id id for the title\n     * @returns {any}\n     */\n    function title(id) {\n        let title = document.createElementNS('http://www.w3.org/2000/svg', 'title');\n        title.setAttribute('id', id);\n        return title;\n    }\n\n    /**\n     * Returns a circle tag with the given dimensions.\n     * @param {*} x x coordinate of the center\n     * @param {*} y y coordinate of the center\n     * @param {*} r radius\n     * @param {*} classes classes to add\n     * @param {*} id id of the circle\n     * @returns {any}\n     */\n    function circle(x, y, r, classes, id) {\n        let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n        circle.setAttribute('class', classes);\n        circle.setAttribute('id', id);\n        circle.setAttribute('cx', x);\n        circle.setAttribute('cy', y);\n        circle.setAttribute('r', r);\n        return circle;\n    }\n\n    /**\n     * Returns a line between two points.\n     * @param {*} x1 x coordinate of the first point\n     * @param {*} y1 y coordinate of the first point\n     * @param {*} x2 x coordinate of the second point\n     * @param {*} y2 y coordinate of the second point\n     * @param {*} classes CSS classes to set\n     * @param {*} id id of the line\n     * @returns {any}\n     */\n    function line(x1, y1, x2, y2, classes, id) {\n        let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n        line.setAttribute('class', classes);\n        line.setAttribute('id', id);\n        line.setAttribute('x1', x1);\n        line.setAttribute('y1', y1);\n        line.setAttribute('x2', x2);\n        line.setAttribute('y2', y2);\n        return line;\n    }\n\n    /**\n     * Returns a link around a given child element. This function also adds a title element next\n     * to the child for accessibility.\n     * @param {*} child child item to set the link on\n     * @param {*} id id of the link\n     * @param {*} title title of the link\n     * @returns {any}\n     */\n    function link(child, id, title = null) {\n        let link = document.createElementNS('http://www.w3.org/2000/svg', 'a');\n        link.setAttribute('id', id);\n        link.setAttribute('xlink:href', '');\n        link.appendChild(child);\n        if (!(title === null)) {\n            link.appendChild(title);\n        }\n        return link;\n    }\n\n    /**\n     * Adds a place on the SVG map. This function also prepares the code for linking activities\n     * and adding titles (for accessibility).\n     * @param {*} event event causing the command\n     */\n    function addPlace(event) {\n        let placesgroup = document.getElementById('placesGroup');\n        let placeId = 'p' + placestore.id;\n        let linkId = 'a' + placestore.id;\n        var CTM = event.target.getScreenCTM();\n        if (event.touches) {\n            event = event.touches[0];\n        }\n        let cx = (event.clientX - CTM.e) / CTM.a;\n        let cy = (event.clientY - CTM.f) / CTM.d;\n        placesgroup.appendChild(\n            link(\n                circle(cx, cy, 10, 'learningmap-place learningmap-draggable', placeId),\n                linkId,\n                title('title' + placeId)\n            )\n        );\n        placestore.places.push({\n            id: placeId,\n            linkId: linkId,\n            linkedActivity: null\n        });\n        if (placestore.places.length == 1) {\n            placestore.startingplaces.push(placeId);\n        }\n        placestore.id++;\n    }\n\n    /**\n     * Handles single clicks on the background image.\n     * @param {*} event click event\n     * @returns {void}\n     */\n    function clickHandler(event) {\n        event.preventDefault();\n        hideContextMenu();\n        if (event.target.classList.contains('learningmap-place') && selectedElement === null) {\n            if (firstPlace === null) {\n                firstPlace = event.target.id;\n                document.getElementById(firstPlace).classList.add('learningmap-selected');\n            } else {\n                secondPlace = event.target.id;\n                let fid = parseInt(firstPlace.replace('p', ''));\n                let sid = parseInt(secondPlace.replace('p', ''));\n                if (sid == fid) {\n                    return;\n                }\n                if (sid < fid) {\n                    let z = sid;\n                    sid = fid;\n                    fid = z;\n                }\n                addPath(fid, sid);\n                let first = document.getElementById(firstPlace);\n                if (first) {\n                    first.classList.remove('learningmap-selected');\n                }\n                firstPlace = null;\n                lastTarget = secondPlace;\n                secondPlace = null;\n            }\n        } else {\n            let p = document.getElementById(firstPlace);\n            if (!(p === null)) {\n                p.classList.remove('learningmap-selected');\n            }\n            firstPlace = null;\n        }\n    }\n\n    /**\n     * Adds a path between two places.\n     * @param {number} fid id of the first place (meant to be the smaller one)\n     * @param {number} sid id of the second place (meant to be the bigger one)\n     */\n    function addPath(fid, sid) {\n        let pid = 'p' + fid + '_' + sid;\n        if (document.getElementById(pid) === null) {\n            let pathsgroup = document.getElementById('pathsGroup');\n            let first = document.getElementById('p' + fid);\n            let second = document.getElementById('p' + sid);\n            if (pathsgroup && first && second) {\n                pathsgroup.appendChild(\n                    line(\n                        first.cx.baseVal.value,\n                        first.cy.baseVal.value,\n                        second.cx.baseVal.value,\n                        second.cy.baseVal.value,\n                        'learningmap-path',\n                        pid\n                    )\n                );\n                placestore.paths.push({\n                    id: pid,\n                    fid: 'p' + fid,\n                    sid: 'p' + sid\n                });\n            }\n        }\n    }\n\n    /**\n     * Removes a place from the SVG and the placestore. This function also removes all\n     * touching paths and entries in statringplaces / targetplaces linking to the removed\n     * place.\n     * @param {any} event event causing the remove order\n     */\n    function removePlace(event) {\n        let place = document.getElementById(event.target.id);\n        let parent = place.parentNode;\n        removePathsTouchingPlace(event.target.id);\n        placestore.places = placestore.places.filter(\n            function(p) {\n                return p.id != event.target.id;\n            }\n        );\n        placestore.startingplaces = placestore.startingplaces.filter(\n            function(e) {\n                return e != event.target.id;\n            }\n        );\n        placestore.targetplaces = placestore.targetplaces.filter(\n            function(e) {\n                return e != event.target.id;\n            }\n        );\n        parent.removeChild(place);\n        parent.parentNode.removeChild(parent);\n\n        updateCode();\n    }\n\n    /**\n     * Removes all paths touching a certain place\n     * @param {number} id id of the place\n     */\n    function removePathsTouchingPlace(id) {\n        placestore.paths.forEach(\n            function(e) {\n                if (e.fid == id || e.sid == id) {\n                    removePath(e.id);\n                }\n            }\n        );\n    }\n\n    /**\n     * Removes a path from the SVG and from the placestore\n     * @param {number} id id of the path\n     */\n    function removePath(id) {\n        let path = document.getElementById(id);\n        if (!(path === null)) {\n            path.parentNode.removeChild(path);\n            removePathFromPlacestore(id);\n        }\n    }\n\n    /**\n     * Removes a path from the placestore\n     * @param {number} pid id of the path to remove\n     */\n    function removePathFromPlacestore(pid) {\n        placestore.paths = placestore.paths.filter(\n            function(e) {\n                return pid != e.id;\n            }\n        );\n    }\n\n    /**\n     * Fetches the course module id linked activity\n     * @param {number} id id of the place\n     * @returns {(number|null)} id of the linked activity\n     */\n    function getActivityIdFromPlacestore(id) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            return place[0].linkedActivity;\n        } else {\n            return null;\n        }\n    }\n\n    /**\n     * Sets the id of the linked activity of a place.\n     * @param {*} id id of the place\n     * @param {*} linkedActivity Course module id of the linked activity\n     */\n    function setActivityIdInPlacestore(id, linkedActivity) {\n        let place = placestore.places.filter(\n            function(e) {\n                return id == e.id;\n            }\n        );\n        if (place.length > 0) {\n            place[0].linkedActivity = linkedActivity;\n        }\n        updateCode();\n    }\n\n    /**\n     * Sets the background image of the SVG to the current image in filemanager.\n     */\n    function refreshBackgroundImage() {\n        let previewimage = document.getElementsByClassName('realpreview');\n        if (previewimage.length > 0) {\n            let background = document.getElementById('learningmap-background-image');\n            background.setAttribute('xlink:href', previewimage[0].getAttribute('src').split('?')[0]);\n        }\n    }\n\n    /**\n     * Adds an eventListener to the background image for watching file changes and updating\n     * height and width of the image.\n     */\n    function registerBackgroundListener() {\n        let background = document.getElementById('learningmap-background-image');\n        background.addEventListener('load', function() {\n            let height = parseInt(background.getBBox().height);\n            let width = background.getBBox().width;\n            placestore.height = height;\n            placestore.width = width;\n            updateCode();\n            processPlacestore();\n        });\n    }\n\n    /**\n     * Updates the viewBox attribute of the SVG to the dimensions of the background image.\n     */\n    function processPlacestore() {\n        let svg = document.getElementById('learningmap-svgmap');\n        svg.setAttribute('viewBox', '0 0 ' + placestore.width + ' ' + placestore.height);\n    }\n\n    /**\n     * Updates CSS code inside the SVG (called, when one of the colors is changed).\n     * Calls updateCode() when completed.\n     */\n    function updateCSS() {\n        Templates.renderForPromise('mod_learningmap/cssskeleton', placestore)\n            .then(({html, js}) => {\n                Templates.replaceNode('#learningmap-svgstyle', html, js);\n                updateCode();\n                return true;\n            })\n            .catch(ex => displayException(ex));\n    }\n};\n"],"file":"learningmap.min.js"}