define ("mod_learningmap/learningmap",["exports","core/notification","core/templates"],function(a,b,c){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=function(a){return a&&a.__esModule?a:{default:a}}(c);var d=function(){c.default.prefetchTemplates(["mod_learningmap/cssskeleton"]);var y,z,A=null,B=null,C=null,D=null,E=document.getElementById("learningmap-editor-map"),F=document.getElementById("id_introeditor_text"),G=document.getElementById("learningmap-activity-setting"),H=document.getElementById("learningmap-activity-selector"),I=document.getElementById("learningmap-activity-starting"),J=document.getElementById("learningmap-activity-target"),K=document.getElementById("learningmap-color-place"),L=document.getElementById("learningmap-color-visited"),M=document.getElementById("learningmap-color-path");if(H){H.addEventListener("change",function(){t(D,H.value)});I.addEventListener("change",function(){if(I.checked){N.startingplaces.push(D)}else{N.startingplaces=N.startingplaces.filter(function(a){return a!=D})}f()});J.addEventListener("change",function(){if(J.checked){N.targetplaces.push(D)}else{N.targetplaces=N.targetplaces.filter(function(a){return a!=D})}f()})}var N={id:0,places:[],paths:[],startingplaces:[],targetplaces:[],placecolor:"#c01c28",strokecolor:"#ffffff",visitedcolor:"#26a269",height:100,width:800,editmode:!0};try{var Q=JSON.parse(document.getElementsByName("placestore")[0].value);N={placestore:N,fromjson:Q};u()}catch(a){}if(M){M.addEventListener("change",function(){N.strokecolor=M.value;x()});M.value=N.strokecolor}if(K){K.addEventListener("change",function(){N.placecolor=K.value;x()});K.value=N.placecolor}if(L){L.addEventListener("change",function(){N.visitedcolor=L.value;x()});L.value=N.visitedcolor}E.innerHTML=F.value;u();x();E.addEventListener("dblclick",g);E.addEventListener("click",m);E.addEventListener("contextmenu",function(b){a(b);b.preventDefault()},!1);function a(a){if(D){document.getElementById(D).classList.remove("learningmap-selected-activity-selector")}if(G){if(a.target.classList.contains("learningmap-place")){a.target.classList.add("learningmap-selected-activity-selector");var b=s(a.target.id);G.setAttribute("style","top: "+a.offsetY+"px; left: "+a.offsetX+"px;");G.removeAttribute("hidden");document.getElementById("learningmap-activity-selector").value=b;if(N.startingplaces.includes(a.target.id)){document.getElementById("learningmap-activity-starting").setAttribute("checked","on")}else{document.getElementById("learningmap-activity-starting").removeAttribute("checked","")}if(N.targetplaces.includes(a.target.id)){document.getElementById("learningmap-activity-target").setAttribute("checked","on")}else{document.getElementById("learningmap-activity-target").removeAttribute("checked","")}D=a.target.id}else{d()}}}function d(){var a=document.getElementById(D);if(a){a.classList.remove("learningmap-selected-activity-selector")}G.setAttribute("hidden","")}var O=document.getElementById("id_introeditor_itemid_fieldset"),P=new MutationObserver(u);P.observe(O,{attributes:!0,childList:!0,subtree:!0});function e(a){a.addEventListener("mousedown",c);a.addEventListener("mousemove",d);a.addEventListener("mouseup",e);a.addEventListener("mouseleave",e);a.addEventListener("touchstart",c);a.addEventListener("touchmove",d);a.addEventListener("touchend",e);a.addEventListener("touchleave",e);a.addEventListener("touchcancel",e);function b(b){var c=a.getScreenCTM();if(b.touches){b=b.touches[0]}return{x:(b.clientX-c.e)/c.a,y:(b.clientY-c.f)/c.d}}function c(a){if(a.target.classList.contains("learningmap-draggable")){y=a.target;z=b(a);z.x-=parseFloat(y.getAttributeNS(null,"cx"));z.y-=parseFloat(y.getAttributeNS(null,"cy"))}}function d(a){if(y){a.preventDefault();var c=b(a),e=c.x-z.x,f=c.y-z.y;y.setAttributeNS(null,"cx",e);y.setAttributeNS(null,"cy",f);var d=N.paths.filter(function(a){return a.fid==y.id});d.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x1",e);b.setAttribute("y1",f)}});var g=N.paths.filter(function(a){return a.sid==y.id});g.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x2",e);b.setAttribute("y2",f)}})}}function e(){y=!1;f()}}function f(){var a=document.getElementById("learningmap-editor-map"),b=document.getElementById("id_introeditor_text");b.innerHTML=a.innerHTML;document.getElementsByName("placestore")[0].value=JSON.stringify(N)}function g(a){d();if(a.target.classList.contains("learningmap-mapcontainer")||a.target.classList.contains("learningmap-background-image")){l(a)}else if(a.target.classList.contains("learningmap-place")){if(C==a.target.id){C=null;m(a)}else{o(a)}}else if(a.target.classList.contains("learningmap-path")){q(a.target.id)}f()}function h(a){var b=document.createElementNS("http://www.w3.org/2000/svg","title");b.setAttribute("id",a);return b}function i(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("class",d);f.setAttribute("id",e);f.setAttribute("cx",a);f.setAttribute("cy",b);f.setAttribute("r",c);return f}function j(a,b,c,d,e,f){var g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("class",e);g.setAttribute("id",f);g.setAttribute("x1",a);g.setAttribute("y1",b);g.setAttribute("x2",c);g.setAttribute("y2",d);return g}function k(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,d=document.createElementNS("http://www.w3.org/2000/svg","a");d.setAttribute("id",b);d.setAttribute("xlink:href","");d.appendChild(a);if(!(null===c)){d.appendChild(c)}return d}function l(a){var b=document.getElementById("placesGroup"),c="p"+N.id,d="a"+N.id,e=a.target.getScreenCTM();if(a.touches){a=a.touches[0]}var f=(a.clientX-e.e)/e.a,g=(a.clientY-e.f)/e.d;b.appendChild(k(i(f,g,10,"learningmap-place learningmap-draggable",c),d,h("title"+c)));N.places.push({id:c,linkId:d,linkedActivity:null});if(1==N.places.length){N.startingplaces.push(c)}N.id++}function m(a){d();if(a.target.classList.contains("learningmap-place")){a.preventDefault();if(null===A){A=a.target.id;document.getElementById(A).classList.add("learningmap-selected")}else{B=a.target.id;var b=parseInt(A.replace("p","")),c=parseInt(B.replace("p",""));if(c==b){return}if(c<b){var e=c;c=b;b=e}n(b,c);var f=document.getElementById(A);if(f){f.classList.remove("learningmap-selected")}A=null;C=B;B=null}}else{var g=document.getElementById(A);if(!(null===g)){g.classList.remove("learningmap-selected")}A=null}}function n(a,b){var c="p"+a+"_"+b;if(null===document.getElementById(c)){var d=document.getElementById("pathsGroup"),e=document.getElementById("p"+a),f=document.getElementById("p"+b);if(d&&e&&f){d.appendChild(j(e.cx.baseVal.value,e.cy.baseVal.value,f.cx.baseVal.value,f.cy.baseVal.value,"learningmap-path",c));N.paths.push({id:c,fid:"p"+a,sid:"p"+b})}}}function o(a){var b=document.getElementById(a.target.id),c=b.parentNode;p(a.target.id);N.places=N.places.filter(function(b){return b.id!=a.target.id});N.startingplaces=N.startingplaces.filter(function(b){return b!=a.target.id});N.targetplaces=N.targetplaces.filter(function(b){return b!=a.target.id});c.removeChild(b);c.parentNode.removeChild(c);f()}function p(a){N.paths.forEach(function(b){if(b.fid==a||b.sid==a){q(b.id)}})}function q(a){var b=document.getElementById(a);if(!(null===b)){b.parentNode.removeChild(b);r(a)}}function r(a){N.paths=N.paths.filter(function(b){return a!=b.id})}function s(a){var b=N.places.filter(function(b){return a==b.id});if(0<b.length){return b[0].linkedActivity}else{return null}}function t(a,b){var c=N.places.filter(function(b){return a==b.id});if(0<c.length){c[0].linkedActivity=b}f()}function u(){var a=document.getElementsByClassName("realpreview");if(0<a.length){var b=document.getElementById("learningmap-background-image");b.setAttribute("xlink:href",a[0].getAttribute("src").split("?")[0])}}function v(){var a=document.getElementById("learningmap-background-image");a.addEventListener("load",function(){var b=parseInt(a.getBBox().height),c=a.getBBox().width;N.height=b;N.width=c;f();w()})}function w(){var a=document.getElementById("learningmap-svgmap");a.setAttribute("viewBox","0 0 "+N.width+" "+N.height)}function x(){c.default.renderForPromise("mod_learningmap/cssskeleton",N).then(function(a){var b=a.html;E.innerHTML=E.innerHTML.replace(/<style[\s\S]*style>/i,b);f();v();e(document.getElementById("learningmap-svgmap"));return!0}).catch(function(a){return(0,b.exception)(a)})}};a.init=d});
//# sourceMappingURL=learningmap.min.js.map
