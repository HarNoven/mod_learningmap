define ("mod_learningmap/learningmap",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;a.init=function init(){var t,u,v=null,w=null,x=null,y=null,z=document.getElementById("learningmap-editor-map"),A=document.getElementById("id_introeditor_text"),B=document.getElementById("learningmap-activity-setting"),C=document.getElementById("learningmap-activity-selector"),D=document.getElementById("learningmap-activity-starting"),E=document.getElementById("learningmap-activity-target");if(C){C.addEventListener("change",function(){q(y,C.value)});D.addEventListener("change",function(){if(D.checked){F.startingplaces.push(y)}else{F.startingplaces=F.startingplaces.filter(function(a){return a!=y})}c()});E.addEventListener("change",function(){if(E.checked){F.targetplaces.push(y)}else{F.targetplaces=F.targetplaces.filter(function(a){return a!=y})}c()})}var F;try{F=JSON.parse(document.getElementsByName("placestore")[0].value);r()}catch(a){F={id:0,places:[],paths:[],startingplaces:[],targetplaces:[],placecolor:"red",strokecolor:"white",height:100,width:800}}z.innerHTML=A.value;r();z.addEventListener("dblclick",d);z.addEventListener("click",j);z.addEventListener("contextmenu",function(b){a(b);b.preventDefault()},!1);function a(a){if(y){document.getElementById(y).classList.remove("learningmap-selected-activity-selector")}if(B){if(a.target.classList.contains("learningmap-place")){a.target.classList.add("learningmap-selected-activity-selector");var c=p(a.target.id);B.setAttribute("style","top: "+a.offsetY+"px; left: "+a.offsetX+"px;");B.removeAttribute("hidden");document.getElementById("learningmap-activity-selector").value=c;if(F.startingplaces.includes(a.target.id)){document.getElementById("learningmap-activity-starting").setAttribute("checked","on")}else{document.getElementById("learningmap-activity-starting").removeAttribute("checked","")}if(F.targetplaces.includes(a.target.id)){document.getElementById("learningmap-activity-target").setAttribute("checked","on")}else{document.getElementById("learningmap-activity-target").removeAttribute("checked","")}y=a.target.id}else{b()}}}function b(){var a=document.getElementById(y);if(a){a.classList.remove("learningmap-selected-activity-selector")}B.setAttribute("hidden","")}var G=document.getElementById("id_introeditor_itemid_fieldset"),H=new MutationObserver(r);H.observe(G,{attributes:!0,childList:!0,subtree:!0});(function(a){a.addEventListener("mousedown",d);a.addEventListener("mousemove",e);a.addEventListener("mouseup",f);a.addEventListener("mouseleave",f);a.addEventListener("touchstart",d);a.addEventListener("touchmove",e);a.addEventListener("touchend",f);a.addEventListener("touchleave",f);a.addEventListener("touchcancel",f);function b(b){var c=a.getScreenCTM();if(b.touches){b=b.touches[0]}return{x:(b.clientX-c.e)/c.a,y:(b.clientY-c.f)/c.d}}function d(a){if(a.target.classList.contains("learningmap-draggable")){t=a.target;u=b(a);u.x-=parseFloat(t.getAttributeNS(null,"cx"));u.y-=parseFloat(t.getAttributeNS(null,"cy"))}}function e(a){if(t){a.preventDefault();var c=b(a),e=c.x-u.x,f=c.y-u.y;t.setAttributeNS(null,"cx",e);t.setAttributeNS(null,"cy",f);var d=F.paths.filter(function(a){return a.fid==t.id});d.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x1",e);b.setAttribute("y1",f)}});var g=F.paths.filter(function(a){return a.sid==t.id});g.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x2",e);b.setAttribute("y2",f)}})}}function f(){t=!1;c()}})(document.getElementById("learningmap_svgmap"));var I=document.getElementById("learningmap-background-image");I.addEventListener("load",function(){var a=parseInt(I.getBBox().height),b=I.getBBox().width;F.height=a;F.width=b;c();s()});function c(){var a=document.getElementById("learningmap-editor-map"),b=document.getElementById("id_introeditor_text");b.innerHTML=a.innerHTML;document.getElementsByName("placestore")[0].value=JSON.stringify(F)}function d(a){b();if(a.target.classList.contains("learningmap-mapcontainer")||a.target.classList.contains("learningmap-background-image")){i(a)}else if(a.target.classList.contains("learningmap-place")){if(x==a.target.id){x=null;j(a)}else{l(a)}}else if(a.target.classList.contains("learningmap-path")){n(a.target.id)}c()}function e(a){var b=document.createElementNS("http://www.w3.org/2000/svg","title");b.setAttribute("id",a);return b}function f(a,b,c,d,e){var f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("class",d);f.setAttribute("id",e);f.setAttribute("cx",a);f.setAttribute("cy",b);f.setAttribute("r",c);return f}function g(a,b,c,d,e,f){var g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("class",e);g.setAttribute("id",f);g.setAttribute("x1",a);g.setAttribute("y1",b);g.setAttribute("x2",c);g.setAttribute("y2",d);return g}function h(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null,d=document.createElementNS("http://www.w3.org/2000/svg","a");d.setAttribute("id",b);d.setAttribute("xlink:href","");d.appendChild(a);if(!(null===c)){d.appendChild(c)}return d}function i(a){var b=document.getElementById("placesGroup"),c="p"+F.id,d="a"+F.id,g=a.target.getScreenCTM();if(a.touches){a=a.touches[0]}var i=(a.clientX-g.e)/g.a,j=(a.clientY-g.f)/g.d;b.appendChild(h(f(i,j,10,"learningmap-place learningmap-draggable",c),d,e("title"+c)));F.places.push({id:c,linkId:d,linkedActivity:null});if(1==F.places.length){F.startingplaces.push(c)}F.id++}function j(a){b();if(a.target.classList.contains("learningmap-place")){a.preventDefault();if(null===v){v=a.target.id;document.getElementById(v).classList.add("learningmap-selected")}else{w=a.target.id;var c=parseInt(v.replace("p","")),d=parseInt(w.replace("p",""));if(d==c){return}if(d<c){var e=d;d=c;c=e}k(c,d);var f=document.getElementById(v);if(f){f.classList.remove("learningmap-selected")}v=null;x=w;w=null}}else{var g=document.getElementById(v);if(!(null===g)){g.classList.remove("learningmap-selected")}v=null}}function k(a,b){var c="p"+a+"_"+b;if(null===document.getElementById(c)){var d=document.getElementById("pathsGroup"),e=document.getElementById("p"+a),f=document.getElementById("p"+b);if(d&&e&&f){d.appendChild(g(e.cx.baseVal.value,e.cy.baseVal.value,f.cx.baseVal.value,f.cy.baseVal.value,"learningmap-path",c));F.paths.push({id:c,fid:"p"+a,sid:"p"+b})}}}function l(a){var b=document.getElementById(a.target.id),d=b.parentNode;m(a.target.id);F.places=F.places.filter(function(b){return b.id!=a.target.id});F.startingplaces=F.startingplaces.filter(function(b){return b!=a.target.id});F.targetplaces=F.targetplaces.filter(function(b){return b!=a.target.id});d.removeChild(b);d.parentNode.removeChild(d);c()}function m(a){F.paths.forEach(function(b){if(b.fid==a||b.sid==a){n(b.id)}})}function n(a){var b=document.getElementById(a);if(!(null===b)){b.parentNode.removeChild(b);o(a)}}function o(a){F.paths=F.paths.filter(function(b){return a!=b.id})}function p(a){var b=F.places.filter(function(b){return a==b.id});if(0<b.length){return b[0].linkedActivity}else{return null}}function q(a,b){var d=F.places.filter(function(b){return a==b.id});if(0<d.length){d[0].linkedActivity=b}c()}function r(){var a=document.getElementsByClassName("realpreview");if(0<a.length){var b=document.getElementById("learningmap-background-image");b.setAttribute("xlink:href",a[0].getAttribute("src").split("?")[0])}}function s(){var a=document.getElementById("learningmap_svgmap");a.setAttribute("viewBox","0 0 "+F.width+" "+F.height)}}});
//# sourceMappingURL=learningmap.min.js.map
