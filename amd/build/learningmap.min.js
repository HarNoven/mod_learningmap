define ("mod_learningmap/learningmap",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;a.init=function init(){var r,s,t=null,u=null,v=null,w=null,x=document.getElementById("learningmap-editor-map"),y=document.getElementById("id_introeditor_text"),z=document.getElementById("learningmap-activity-setting"),A=document.getElementById("learningmap-activity-selector"),B=document.getElementById("learningmap-activity-starting");if(A){A.addEventListener("change",function(){q(w,A.value)});B.addEventListener("change",function(){if(B.checked){C.startingplaces.push(w)}else{C.startingplaces=C.startingplaces.filter(function(a){return a!=w})}c()})}var C;try{C=JSON.parse(document.getElementsByName("placestore")[0].value)}catch(a){C={id:0,places:[],paths:[],startingplaces:[],placecolor:"red",strokecolor:"white"}}x.innerHTML=y.value;x.addEventListener("dblclick",d);x.addEventListener("click",j);x.addEventListener("contextmenu",function(b){a(b);b.preventDefault()},!1);function a(a){if(w){document.getElementById(w).classList.remove("selected2")}if(z){if(a.target.classList.contains("place")){a.target.classList.add("selected2");var c=p(a.target.id);z.setAttribute("style","top: "+a.offsetY+"px; left: "+a.offsetX+"px;");z.removeAttribute("hidden");document.getElementById("learningmap-activity-selector").value=c;if(C.startingplaces.includes(a.target.id)){document.getElementById("learningmap-activity-starting").setAttribute("checked","on")}else{document.getElementById("learningmap-activity-starting").removeAttribute("checked","")}w=a.target.id}else{b()}}}function b(){var a=document.getElementById(w);if(a){a.classList.remove("selected2")}z.setAttribute("hidden","")}var D=document.getElementById("id_introeditor_itemid_fieldset"),E=new MutationObserver(function(){var a=document.getElementsByClassName("realpreview");if(0<a.length){var b=document.getElementById("learningmap-background-image");b.setAttribute("xlink:href",a[0].getAttribute("src").split("?")[0]);c()}});E.observe(D,{attributes:!0,childList:!0,subtree:!0});(function(a){a.addEventListener("mousedown",d);a.addEventListener("mousemove",e);a.addEventListener("mouseup",f);a.addEventListener("mouseleave",f);a.addEventListener("touchstart",d);a.addEventListener("touchmove",e);a.addEventListener("touchend",f);a.addEventListener("touchleave",f);a.addEventListener("touchcancel",f);function b(b){var c=a.getScreenCTM();if(b.touches){b=b.touches[0]}return{x:(b.clientX-c.e)/c.a,y:(b.clientY-c.f)/c.d}}function d(a){if(a.target.classList.contains("draggable")){r=a.target;s=b(a);s.x-=parseFloat(r.getAttributeNS(null,"cx"));s.y-=parseFloat(r.getAttributeNS(null,"cy"))}}function e(a){if(r){a.preventDefault();var c=b(a),e=c.x-s.x,f=c.y-s.y;r.setAttributeNS(null,"cx",e);r.setAttributeNS(null,"cy",f);var d=C.paths.filter(function(a){return a.fid==r.id});d.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x1",e);b.setAttribute("y1",f)}});var g=C.paths.filter(function(a){return a.sid==r.id});g.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x2",e);b.setAttribute("y2",f)}})}}function f(){r=!1;c()}})(document.getElementById("learningmap_svgmap"));function c(){var a=document.getElementById("learningmap-editor-map"),b=document.getElementById("id_introeditor_text");b.innerHTML=a.innerHTML;document.getElementsByName("placestore")[0].value=JSON.stringify(C)}function d(a){b();if(a.target.classList.contains("learningmap-mapcontainer")||a.target.classList.contains("learningmap-background-image")){i(a)}else if(a.target.classList.contains("place")){if(v==a.target.id){v=null;j(a)}else{l(a)}}else if(a.target.classList.contains("path")){n(a.target.id)}c()}function e(a){var b=document.createElementNS("http://www.w3.org/2000/svg","title");b.setAttribute("id",a);return b}function f(a,b,c,d,f){var g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("class",d);g.setAttribute("id",f);g.setAttribute("cx",a);g.setAttribute("cy",b);g.setAttribute("r",c);g.appendChild(e("title"+f));return g}function g(a,b,c,d,f,g){var h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("class",f);h.setAttribute("id",g);h.setAttribute("x1",a);h.setAttribute("y1",b);h.setAttribute("x2",c);h.setAttribute("y2",d);h.appendChild(e("title"+g));return h}function h(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","a");c.setAttribute("id",b);c.setAttribute("xlink:href","");c.appendChild(a);return c}function i(a){var b=document.getElementById("placesGroup"),c="p"+C.id,d="a"+C.id;b.appendChild(h(f(a.offsetX,a.offsetY,10,"place draggable",c),d));C.places.push({id:c,linkId:d,linkedActivity:null});if(1==C.places.length){C.startingplaces.push(c)}C.id++}function j(a){b();if(a.target.classList.contains("place")){a.preventDefault();if(null===t){t=a.target.id;document.getElementById(t).classList.add("selected")}else{u=a.target.id;var c=parseInt(t.replace("p","")),d=parseInt(u.replace("p",""));if(d==c){return}if(d<c){var e=d;d=c;c=e}k(c,d);var f=document.getElementById(t);if(f){f.classList.remove("selected")}t=null;v=u;u=null}}else{var g=document.getElementById(t);if(!(null===g)){g.classList.remove("selected")}t=null}}function k(a,b){var c="p"+a+"_"+b;if(null===document.getElementById(c)){var d=document.getElementById("pathsGroup"),e=document.getElementById("p"+a),f=document.getElementById("p"+b);if(e&&f){d.appendChild(g(e.cx.baseVal.value,e.cy.baseVal.value,f.cx.baseVal.value,f.cy.baseVal.value,"path",c));C.paths.push({id:c,fid:"p"+a,sid:"p"+b})}}}function l(a){var b=document.getElementById(a.target.id),d=b.parentNode;m(a.target.id);C.places=C.places.filter(function(b){return b.id!=a.target.id});C.startingplaces=C.startingplaces.filter(function(b){return b!=a.target.id});d.removeChild(b);d.parentNode.removeChild(d);c()}function m(a){C.paths.forEach(function(b){if(b.fid==a||b.sid==a){n(b.id)}})}function n(a){var b=document.getElementById(a);if(!(null===b)){b.parentNode.removeChild(b);o(a)}}function o(a){C.paths=C.paths.filter(function(b){return a!=b.id})}function p(a){var b=C.places.filter(function(b){return a==b.id});if(0<b.length){return b[0].linkedActivity}else{return null}}function q(a,b){var d=C.places.filter(function(b){return a==b.id});if(0<d.length){d[0].linkedActivity=b}c()}}});
//# sourceMappingURL=learningmap.min.js.map
