define ("mod_learningmap/learningmap",["exports"],function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;a.init=function init(){var q,r,s=null,t=null,u=null,v=null,w=document.getElementById("learningmap-editor-map"),x=document.getElementById("id_introeditor_text"),y=document.getElementById("learningmap-activity-setting"),z=document.getElementById("learningmap-activity-selector"),A=document.getElementById("learningmap-activity-starting");if(z){z.addEventListener("change",function(){p(v,z.value)});A.addEventListener("change",function(){if(A.checked){B.startingplaces.push(v)}else{B.startingplaces=B.startingplaces.filter(function(a){return a!=v})}c()})}var B;try{B=JSON.parse(document.getElementsByName("placestore")[0].value)}catch(a){B={id:0,places:[],paths:[],startingplaces:["p0"],placecolor:"red",strokecolor:"white"}}w.innerHTML=x.value;w.addEventListener("dblclick",d);w.addEventListener("click",j);w.addEventListener("contextmenu",function(b){a(b);b.preventDefault()},!1);function a(a){if(v){document.getElementById(v).classList.remove("selected2")}if(y){if(a.target.classList.contains("place")){a.target.classList.add("selected2");var c=o(a.target.id);y.setAttribute("style","top: "+a.offsetY+"px; left: "+a.offsetX+"px;");y.removeAttribute("hidden");document.getElementById("learningmap-activity-selector").value=c;if(B.startingplaces.includes(a.target.id)){document.getElementById("learningmap-activity-starting").setAttribute("checked","")}else{document.getElementById("learningmap-activity-starting").removeAttribute("checked","")}v=a.target.id}else{b()}}}function b(){var a=document.getElementById(v);if(a){a.classList.remove("selected2")}y.setAttribute("hidden","")}var C=document.getElementById("id_introeditor_itemid_fieldset"),D=new MutationObserver(function(){var a=document.getElementsByClassName("realpreview");if(0<a.length){var b=document.getElementById("learningmap-background-image");b.setAttribute("xlink:href",a[0].getAttribute("src").split("?")[0]);c()}});D.observe(C,{attributes:!0,childList:!0,subtree:!0});(function(a){a.addEventListener("mousedown",d);a.addEventListener("mousemove",e);a.addEventListener("mouseup",f);a.addEventListener("mouseleave",f);a.addEventListener("touchstart",d);a.addEventListener("touchmove",e);a.addEventListener("touchend",f);a.addEventListener("touchleave",f);a.addEventListener("touchcancel",f);function b(b){var c=a.getScreenCTM();if(b.touches){b=b.touches[0]}return{x:(b.clientX-c.e)/c.a,y:(b.clientY-c.f)/c.d}}function d(a){if(a.target.classList.contains("draggable")){q=a.target;r=b(a);r.x-=parseFloat(q.getAttributeNS(null,"cx"));r.y-=parseFloat(q.getAttributeNS(null,"cy"))}}function e(a){if(q){a.preventDefault();var c=b(a),e=c.x-r.x,f=c.y-r.y;q.setAttributeNS(null,"cx",e);q.setAttributeNS(null,"cy",f);var d=B.paths.filter(function(a){return a.fid==q.id});d.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x1",e);b.setAttribute("y1",f)}});var g=B.paths.filter(function(a){return a.sid==q.id});g.forEach(function(a){var b=document.getElementById(a.id);if(!(null===b)){b.setAttribute("x2",e);b.setAttribute("y2",f)}})}}function f(){q=!1;c()}})(document.getElementById("learningmap_svgmap"));function c(){var a=document.getElementById("learningmap-editor-map"),b=document.getElementById("id_introeditor_text");b.value=a.innerHTML;document.getElementsByName("placestore")[0].value=JSON.stringify(B)}function d(a){b();if(a.target.classList.contains("learningmap-mapcontainer")||a.target.classList.contains("learningmap-background-image")){i(a)}else if(a.target.classList.contains("place")){if(u==a.target.id){u=null;j(a)}else{l(a)}}else if(a.target.classList.contains("path")){m(a.target.id)}c()}function e(a){var b=document.createElementNS("http://www.w3.org/2000/svg","title");b.setAttribute("id",a);return b}function f(a,b,c,d,f){var g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("class",d);g.setAttribute("id",f);g.setAttribute("cx",a);g.setAttribute("cy",b);g.setAttribute("r",c);g.appendChild(e("title"+f));return g}function g(a,b,c,d,f,g){var h=document.createElementNS("http://www.w3.org/2000/svg","line");h.setAttribute("class",f);h.setAttribute("id",g);h.setAttribute("x1",a);h.setAttribute("y1",b);h.setAttribute("x2",c);h.setAttribute("y2",d);h.appendChild(e("title"+g));return h}function h(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg","a");c.setAttribute("id",b);c.setAttribute("xlink:href","");c.appendChild(a);return c}function i(a){var b=document.getElementById("placesGroup"),c="p"+B.id,d="a"+B.id;b.appendChild(h(f(a.offsetX,a.offsetY,10,"place draggable",c),d));B.places[B.id]={id:c,linkId:d,linkedActivity:null,paths:[]};B.id++}function j(a){b();if(a.target.classList.contains("place")){a.preventDefault();if(null===s){s=a.target.id;document.getElementById(s).classList.add("selected")}else{t=a.target.id;var c=parseInt(s.replace("p","")),d=parseInt(t.replace("p",""));if(d==c){return}if(d<c){var e=d;d=c;c=e}k(c,d);document.getElementById(s).classList.remove("selected");s=null;u=t;t=null}}else{var f=document.getElementById(s);if(!(null===f)){f.classList.remove("selected")}s=null}}function k(a,b){var c="p"+a+"_"+b;if(null===document.getElementById(c)){var d=document.getElementById("pathsGroup");d.appendChild(g(document.getElementById("p"+a).cx.baseVal.value,document.getElementById("p"+a).cy.baseVal.value,document.getElementById("p"+b).cx.baseVal.value,document.getElementById("p"+b).cy.baseVal.value,"path",c));B.places[a].paths.push(c);B.places[b].paths.push(c);B.paths.push({id:c,fid:"p"+a,sid:"p"+b})}}function l(a){var b=document.getElementById(a.target.id),d=b.parentNode,e=parseInt(b.id.replace("p","")),f=B.places[e].paths;f.forEach(function(a){m(a)});B.places=B.places.filter(function(a){return a.id!=e});B.startingplaces.remove(a.target.id);d.removeChild(b);d.parentNode.removeChild(d);c()}function m(a){var b=document.getElementById(a);if(!(null===b)){b.parentNode.removeChild(b);n(a)}}function n(a){var b=B.paths.filter(function(b){return a==b.id})[0];B.places[b.fid].paths=B.places[b.fid].paths.filter(function(b){return a!=b});B.places[b.sid].paths=B.places[b.sid].paths.filter(function(b){return a!=b});B.paths=B.paths.filter(function(b){return a!=b.id})}function o(a){var b=B.places.filter(function(b){return a==b.id});if(0<b.length){return b[0].linkedActivity}else{return null}}function p(a,b){var d=B.places.filter(function(b){return a==b.id});if(0<d.length){d[0].linkedActivity=b}c()}}});
//# sourceMappingURL=learningmap.min.js.map
